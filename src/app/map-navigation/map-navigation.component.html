<div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
  <div class="layout-container flex h-full grow flex-col">
    <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[var(--border-color)] px-10 py-4">
      <div class="flex items-center gap-3 text-[var(--text-primary)]">
        <div class="w-8 h-8 text-[var(--primary-color)]">
          <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4H22V22H4V4ZM26 4H44V22H26V4ZM4 26H22V44H4V26ZM26 26H44V44H26V26Z" fill="currentColor"></path>
          </svg>
        </div>
        <h2 class="text-[var(--text-primary)] text-xl font-bold tracking-tight">Senegal Admin Buildings</h2>
      </div>
      <div class="flex flex-1 justify-end gap-6 items-center">
        <nav class="flex items-center gap-8">
          <a class="text-[var(--text-secondary)] hover:text-[var(--primary-color)] text-base font-medium transition-colors" routerLink="/">Accueil</a>
          <a class="text-[var(--text-primary)] text-base font-semibold" routerLink="/map">Carte</a>
          <a class="text-[var(--text-secondary)] hover:text-[var(--primary-color)] text-base font-medium transition-colors" routerLink="/add-building">Renseigner</a>
        </nav>
        <div class="flex items-center gap-4">
          <div class="relative hidden sm:block">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </div>
            <input class="block w-full rounded-md border-gray-200 bg-gray-50 py-2 pl-10 pr-3 text-sm placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:bg-white focus:ring-[var(--primary-color)]" placeholder="Rechercher" type="text" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()"/>
          </div>
          <div class="flex items-center gap-2">
            <button *ngIf="canAddStructure" (click)="navigateToAddStructure()" class="btn btn-primary text-sm px-3 py-2">
              Ajouter
            </button>
            <button *ngIf="isAuthenticated" (click)="logout()" class="btn btn-secondary text-sm px-3 py-2">
              Déconnexion
            </button>
            <button *ngIf="!isAuthenticated" routerLink="/login" class="btn btn-primary text-sm px-3 py-2">
              Connexion
            </button>
          </div>

        </div>
      </div>
    </header>
    <main class="flex-1 flex flex-row gap-4 p-4 lg:p-6">
      <aside class="w-80 lg:w-96 flex flex-col gap-4">
        <div class="bg-gray-50 rounded-lg p-4 h-full border border-gray-200">
          <!-- Search and Filters -->
          <div class="space-y-4 mb-6">
            <div class="relative">
              <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </div>
              <input class="block w-full rounded-md border-gray-200 bg-white py-2.5 pl-10 pr-3 text-sm placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Rechercher par nom" type="text" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()"/>
            </div>
            
            <div class="grid grid-cols-1 gap-3">
              <select class="form-input text-sm" [(ngModel)]="selectedType" (change)="onFilterChange()">
                <option value="">Tous les types</option>
                <option *ngFor="let type of structureTypes" [value]="type.value">{{ type.label }}</option>
              </select>
              
              <select class="form-input text-sm" [(ngModel)]="selectedRegion" (change)="onRegionChange()">
                <option value="">Toutes les régions</option>
                <option *ngFor="let region of availableRegions" [value]="region">{{ region }}</option>
              </select>
              
              <select *ngIf="selectedRegion" class="form-input text-sm" [(ngModel)]="selectedCity" (change)="onFilterChange()">
                <option value="">Toutes les villes</option>
                <option *ngFor="let city of availableCities" [value]="city">{{ city }}</option>
              </select>
            </div>
            
            <div class="flex gap-2">
              <button (click)="onSearch()" class="btn btn-primary text-sm flex-1">Rechercher</button>
              <button (click)="clearFilters()" class="btn btn-secondary text-sm">Effacer</button>
            </div>
          </div>
          
          <!-- Loading State -->
          <div *ngIf="isLoading" class="text-center py-4">
            <div class="text-sm text-gray-500">Chargement...</div>
          </div>
          
          <!-- Structures List -->
          <div *ngIf="!isLoading">
            <h2 class="text-base font-semibold text-[var(--text-primary)] px-2 pb-3">Structures ({{ filteredStructures.length }})</h2>
            <div class="space-y-3 max-h-96 overflow-y-auto">
              <div *ngFor="let structure of filteredStructures" class="flex items-start gap-4 rounded-lg p-3 hover:bg-gray-100 cursor-pointer border border-gray-200" (click)="selectStructure(structure.id)">
                <div class="flex items-center justify-center rounded-md bg-[var(--secondary-color)] text-[var(--primary-color)] shrink-0 size-10">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-[var(--text-primary)] truncate">{{ structure.name }}</p>
                  <p class="text-xs text-[var(--text-secondary)]">{{ getStructureTypeDisplayName(structure.type) }}</p>
                  <p class="text-xs text-[var(--text-secondary)] truncate">{{ structure.address.city }}, {{ structure.address.region }}</p>
                </div>
              </div>
              
              <div *ngIf="filteredStructures.length === 0" class="text-center py-8">
                <div class="text-sm text-gray-500">Aucune structure trouvée</div>
              </div>
            </div>
          </div>
        </div>
      </aside>
      <section class="flex-1 rounded-lg overflow-hidden relative shadow-lg">
        <div *ngIf="isLoading" class="h-full w-full flex items-center justify-center bg-gray-100">
          <div class="text-center">
            <div class="text-lg font-medium text-gray-700">Chargement de la carte...</div>
            <div class="text-sm text-gray-500 mt-2">Veuillez patienter</div>
          </div>
        </div>
        <div id="map" class="h-full w-full" [class.hidden]="isLoading"></div>
        <div class="absolute top-4 right-4 flex flex-col gap-2">
          <div class="flex flex-col rounded-md bg-white shadow-md">
            <button class="flex size-10 items-center justify-center text-gray-600 hover:bg-gray-100 hover:text-[var(--primary-color)] transition-colors rounded-t-md border-b border-gray-200" (click)="zoomIn()">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4.5v15m7.5-7.5h-15" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>
            <button class="flex size-10 items-center justify-center text-gray-600 hover:bg-gray-100 hover:text-[var(--primary-color)] transition-colors rounded-b-md" (click)="zoomOut()">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.5 12h-15" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>
          </div>
          <button class="flex size-10 items-center justify-center rounded-md bg-white shadow-md text-gray-600 hover:bg-gray-100 hover:text-[var(--primary-color)] transition-colors" (click)="locateUser()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L6 12Z" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
        </div>
      </section>
    </main>
  </div>
</div>
